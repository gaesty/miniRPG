@startuml miniRPG - Class Diagram

skinparam classAttributeIconSize 0
skinparam packageStyle rectangle
skinparam linetype ortho
skinparam groupInheritance 2
skinparam shadowing true
skinparam defaultFontName Segoe UI
skinparam titleFontSize 22
skinparam titleFontStyle bold

' ============================================================
'  GLOBAL STYLE
' ============================================================
skinparam class {
    FontSize 11
    AttributeFontSize 10
    StereotypeFontSize 9
    BorderThickness 1.5
}

skinparam package {
    FontStyle bold
    FontSize 13
    BorderThickness 2
}

' ============================================================
'  COLOR PALETTE
' ============================================================
' --- Factory (Blue) ---
!define FACTORY_PKG_BG #E3F2FD
!define FACTORY_ABC_BG #1565C0
!define FACTORY_CONCRETE_BG #90CAF9
!define FACTORY_FACTORY_BG #42A5F5
!define FACTORY_LOOT_BG #29B6F6

' --- Strategy (Orange) ---
!define STRAT_PKG_BG #FFF3E0
!define STRAT_BASE_BG #E65100
!define STRAT_CONCRETE_BG #FFB74D
!define STRAT_CONTEXT_BG #FF9800

' --- Command (Green) ---
!define CMD_PKG_BG #E8F5E9
!define CMD_BASE_BG #1B5E20
!define CMD_CONCRETE_BG #A5D6A7
!define CMD_INVOKER_BG #4CAF50

' --- Iterator (Purple) ---
!define ITER_PKG_BG #F3E5F5
!define ITER_BASE_BG #4A148C
!define ITER_CONCRETE_BG #CE93D8
!define ITER_SYSTEM_BG #AB47BC

' --- Observer (Red) ---
!define OBS_PKG_BG #FFEBEE
!define OBS_BASE_BG #B71C1C
!define OBS_CONCRETE_BG #EF9A9A

' --- State (Teal) ---
!define STATE_PKG_BG #E0F2F1
!define STATE_BASE_BG #004D40
!define STATE_CONCRETE_BG #80CBC4
!define STATE_CTX_BG #26A69A

' --- Decorator (Amber) ---
!define DECO_PKG_BG #FFF8E1
!define DECO_BASE_BG #FF6F00
!define DECO_CONCRETE_BG #FFD54F

' --- Facade (Indigo) ---
!define FACADE_PKG_BG #E8EAF6
!define FACADE_BG #3F51B5

' --- Adapter (Pink) ---
!define ADAPTER_PKG_BG #FCE4EC
!define ADAPTER_BG #E91E63

' --- GameManager (Grey) ---
!define GM_BG #607D8B

title miniRPG — Complete Class Diagram\n(Design Patterns)

' ████████████████████████████████████████████████████████████
'  FACTORY PATTERN
' ████████████████████████████████████████████████████████████

package "Factory Pattern" as factory_pkg FACTORY_PKG_BG {

    ' ─── Player Factory ───
    package "PlayerFactory" as player_pkg {
        abstract class PlayerBase <<abstract>> FACTORY_ABC_BG {
            + {abstract} get_data(): dict
        }

        class Warrior FACTORY_CONCRETE_BG {
            + get_data(): dict
        }

        class Mage FACTORY_CONCRETE_BG {
            + get_data(): dict
        }

        class Thief FACTORY_CONCRETE_BG {
            + get_data(): dict
        }

        class PlayerFactory FACTORY_FACTORY_BG {
            - _player_map: dict
            + create_player(name: str): dict
        }
    }

    PlayerBase <|-- Warrior
    PlayerBase <|-- Mage
    PlayerBase <|-- Thief
    PlayerFactory ..> PlayerBase : <<creates>>

    ' ─── Enemy Factory ───
    package "EnemyFactory" as enemy_pkg {
        abstract class EnemyBase <<abstract>> FACTORY_ABC_BG {
            + {abstract} get_data(): dict
        }

        class Bandit FACTORY_CONCRETE_BG {
            + get_data(): dict
        }

        class SavageWolf FACTORY_CONCRETE_BG {
            + get_data(): dict
        }

        class Skeleton FACTORY_CONCRETE_BG {
            + get_data(): dict
        }

        class CorruptedChampion FACTORY_CONCRETE_BG {
            + get_data(): dict
        }

        class DungeonKeeper FACTORY_CONCRETE_BG {
            + get_data(): dict
        }

        class EnemyFactory FACTORY_FACTORY_BG {
            - _enemy_map: dict
            + create_enemy(name: str): dict
        }
    }

    EnemyBase <|-- Bandit
    EnemyBase <|-- SavageWolf
    EnemyBase <|-- Skeleton
    EnemyBase <|-- CorruptedChampion
    EnemyBase <|-- DungeonKeeper
    EnemyFactory ..> EnemyBase : <<creates>>

    ' ─── Area Factory ───
    package "AreaFactory" as area_pkg {
        abstract class AreaBase <<abstract>> FACTORY_ABC_BG {
            + {abstract} get_data(): dict
        }

        class AreaVillage FACTORY_CONCRETE_BG {
            + get_data(): dict
        }

        class AreaForest FACTORY_CONCRETE_BG {
            + get_data(): dict
        }

        class AreaDungeon FACTORY_CONCRETE_BG {
            + get_data(): dict
        }

        class AreaFactory FACTORY_FACTORY_BG {
            - _area_map: dict
            + create_area(name: str): dict
        }
    }

    AreaBase <|-- AreaVillage
    AreaBase <|-- AreaForest
    AreaBase <|-- AreaDungeon
    AreaFactory ..> AreaBase : <<creates>>

    ' ─── Item Factory (Weapons) ───
    package "ItemFactory" as item_pkg {

        package "Weapons" as weapon_sub_pkg {
            abstract class WeaponBase <<abstract>> FACTORY_ABC_BG {
                + {abstract} get_data(): dict
            }

            class WoodenSwordClass FACTORY_CONCRETE_BG {
                + get_data(): dict
            }

            class SteelSwordClass FACTORY_CONCRETE_BG {
                + get_data(): dict
            }

            class KnifeClass FACTORY_CONCRETE_BG {
                + get_data(): dict
            }

            class AxeClass FACTORY_CONCRETE_BG {
                + get_data(): dict
            }

            class BowClass FACTORY_CONCRETE_BG {
                + get_data(): dict
            }

            class MagicStickClass FACTORY_CONCRETE_BG {
                + get_data(): dict
            }

            class WeaponFactory FACTORY_FACTORY_BG {
                - _weapon_map: dict
                + create_weapon(name: str): dict
            }
        }

        WeaponBase <|-- WoodenSwordClass
        WeaponBase <|-- SteelSwordClass
        WeaponBase <|-- KnifeClass
        WeaponBase <|-- AxeClass
        WeaponBase <|-- BowClass
        WeaponBase <|-- MagicStickClass
        WeaponFactory ..> WeaponBase : <<creates>>

        ' ─── Item Factory (Armors) ───
        package "Armors" as armor_sub_pkg {
            abstract class ArmorBase <<abstract>> FACTORY_ABC_BG {
                + {abstract} get_data(): dict
            }

            class CapeClass FACTORY_CONCRETE_BG {
                + get_data(): dict
            }

            class LeatherArmorClass FACTORY_CONCRETE_BG {
                + get_data(): dict
            }

            class SteelArmorClass FACTORY_CONCRETE_BG {
                + get_data(): dict
            }

            class MysticDress FACTORY_CONCRETE_BG {
                + get_data(): dict
            }

            class ArmorFactory FACTORY_FACTORY_BG {
                - _armor_map: dict
                + create_armor(name: str): dict
            }
        }

        ArmorBase <|-- CapeClass
        ArmorBase <|-- LeatherArmorClass
        ArmorBase <|-- SteelArmorClass
        ArmorBase <|-- MysticDress
        ArmorFactory ..> ArmorBase : <<creates>>

        ' ─── Item Factory (Consumables) ───
        package "Consumables" as consumable_sub_pkg {
            abstract class ConsumableBase <<abstract>> FACTORY_ABC_BG {
                + {abstract} get_data(): dict
            }

            class HealthPotion FACTORY_CONCRETE_BG {
                + get_data(): dict
            }

            class AntidoteClass FACTORY_CONCRETE_BG {
                + get_data(): dict
            }

            class BombClass FACTORY_CONCRETE_BG {
                + get_data(): dict
            }

            class ConsumableFactory FACTORY_FACTORY_BG {
                - _consumable_map: dict
                + create_consumable(name: str): dict
            }
        }

        ConsumableBase <|-- HealthPotion
        ConsumableBase <|-- AntidoteClass
        ConsumableBase <|-- BombClass
        ConsumableFactory ..> ConsumableBase : <<creates>>

        ' ─── Item Factory (Quest Items) ───
        package "QuestItems" as quest_sub_pkg {
            abstract class QuestItemBase <<abstract>> FACTORY_ABC_BG {
                + {abstract} get_data(): dict
            }

            class KeyClass FACTORY_CONCRETE_BG {
                + get_data(): dict
            }

            class QuestFactory FACTORY_FACTORY_BG {
                - _quest_item_map: dict
                + create_quest_item(name: str): dict
            }
        }

        QuestItemBase <|-- KeyClass
        QuestFactory ..> QuestItemBase : <<creates>>

        ' ─── Central ItemFactory ───
        class ItemFactory FACTORY_FACTORY_BG {
            - _weapon_factory: WeaponFactory
            - _armor_factory: ArmorFactory
            - _consumable_factory: ConsumableFactory
            - _quest_factory: QuestFactory
            + create_item(category: str, name: str): dict
        }
    }

    ItemFactory --> WeaponFactory : delegates
    ItemFactory --> ArmorFactory : delegates
    ItemFactory --> ConsumableFactory : delegates
    ItemFactory --> QuestFactory : delegates

    ' ─── Loot Factory ───
    class LootFactory FACTORY_LOOT_BG {
        - _loot_table: dict
        - _drop_chances: dict
        + generate_loot(area_name: str): list[dict]
        + generate_boss_loot(boss_name: str): list[dict]
    }
}

' ████████████████████████████████████████████████████████████
'  STRATEGY PATTERN
' ████████████████████████████████████████████████████████████

package "Strategy Pattern" as strategy_pkg STRAT_PKG_BG {

    ' ─── Battle Strategy ───
    package "BattleStrategy" as battle_strat_pkg {
        class BattleStrategy STRAT_BASE_BG {
            + execute_attack(attacker, defender)
            + get_strategy_name()
        }

        class AggressiveStrategy STRAT_CONCRETE_BG {
            + execute_attack(attacker, defender)
            + get_strategy_name(): str
        }

        class DefensiveStrategy STRAT_CONCRETE_BG {
            + execute_attack(attacker, defender)
            + get_strategy_name(): str
        }

        class BalancedStrategy STRAT_CONCRETE_BG {
            + execute_attack(attacker, defender)
            + get_strategy_name(): str
        }

        class SpecialSkillStrategy STRAT_CONCRETE_BG {
            + execute_attack(attacker, defender)
            + get_strategy_name(): str
        }

        class BattleContext STRAT_CONTEXT_BG {
            + strategy: BattleStrategy
            + set_strategy(strategy)
            + execute_turn(attacker, defender)
        }
    }

    BattleStrategy <|-- AggressiveStrategy
    BattleStrategy <|-- DefensiveStrategy
    BattleStrategy <|-- BalancedStrategy
    BattleStrategy <|-- SpecialSkillStrategy
    BattleContext o--> BattleStrategy : strategy

    ' ─── Inventory Strategy ───
    package "InventoryStrategy" as inv_strat_pkg {
        class InventoryStrategy STRAT_BASE_BG {
            + execute_action(inventory, item)
            + get_strategy_name()
        }

        class AddItemStrategy STRAT_CONCRETE_BG {
            + execute_action(inventory, item)
            + get_strategy_name(): str
        }

        class RemoveItemStrategy STRAT_CONCRETE_BG {
            + execute_action(inventory, item)
            + get_strategy_name(): str
        }

        class EquipItemStrategy STRAT_CONCRETE_BG {
            + execute_action(inventory, item)
            + get_strategy_name(): str
        }

        class UseItemStrategy STRAT_CONCRETE_BG {
            + execute_action(inventory, item)
            + get_strategy_name(): str
        }

        class InventoryContext STRAT_CONTEXT_BG {
            + strategy: InventoryStrategy
            + set_strategy(strategy)
            + execute_action(inventory, item)
        }
    }

    InventoryStrategy <|-- AddItemStrategy
    InventoryStrategy <|-- RemoveItemStrategy
    InventoryStrategy <|-- EquipItemStrategy
    InventoryStrategy <|-- UseItemStrategy
    InventoryContext o--> InventoryStrategy : strategy

    ' ─── Status Effect Strategy ───
    package "StatusEffectStrategy" as status_strat_pkg {
        abstract class StatusEffectStrategy <<abstract>> STRAT_BASE_BG {
            # duration: int
            + {abstract} addStatusEffect()
            + {abstract} delay(): bool
            + is_expired(): bool
            + __str__(): str
        }

        class Poison STRAT_CONCRETE_BG {
            - target: dict
            - damage: int
            - duration: int
            - active: bool
            + attack()
            + delay()
            + addStatusEffect()
        }

        class Shield STRAT_CONCRETE_BG {
            - target: dict
            - defense_boost: int
            - duration: int
            - applied: bool
            + defense()
            + delay(): bool
            + addStatusEffect()
        }

        class Dizziness STRAT_CONCRETE_BG {
            - target: dict
            - duration: int
            - active: bool
            + passTurn()
            + delay()
            + addStatusEffect()
        }

        class StatusEffectContext STRAT_CONTEXT_BG {
            - _strategy: StatusEffectStrategy
            + set_status_effect_context(battle_strategy)
            + make_status_effect()
        }
    }

    StatusEffectStrategy <|-- Poison
    StatusEffectStrategy <|-- Shield
    StatusEffectStrategy <|-- Dizziness
    StatusEffectContext o--> StatusEffectStrategy : _strategy
}

' ████████████████████████████████████████████████████████████
'  COMMAND PATTERN
' ████████████████████████████████████████████████████████████

package "Command Pattern" as command_pkg CMD_PKG_BG {

    class Command CMD_BASE_BG {
        + execute()
        + undo()
        + get_description()
    }

    class AttackCommand CMD_CONCRETE_BG {
        - attacker: dict
        - defender: dict
        - strategy: BattleStrategy
        - damage_dealt: int
        - defender_pv_before: int
        + execute(): int
        + undo()
        + get_description(): str
    }

    class DefendCommand CMD_CONCRETE_BG {
        - defender: dict
        - defense_boost: int
        - applied: bool
        + execute(): bool
        + undo()
        + get_description(): str
    }

    class FleeCommand CMD_CONCRETE_BG {
        - player: dict
        - success: bool
        + execute(): bool
        + undo()
        + get_description(): str
    }

    class UseItemCommand CMD_CONCRETE_BG {
        - user: dict
        - item: dict
        - inventory_strategy: InventoryStrategy
        - inventory: dict
        - user_pv_before: int
        - item_used: dict
        + execute(): dict
        + undo()
        + get_description(): str
    }

    class CommandInvoker CMD_INVOKER_BG {
        - history: list
        - current_index: int
        + execute_command(command): any
        + undo_last(): bool
        + redo_last(): bool
        + get_history(): list
        + clear_history()
    }
}

Command <|-- AttackCommand
Command <|-- DefendCommand
Command <|-- FleeCommand
Command <|-- UseItemCommand
CommandInvoker o--> "0..*" Command : history
AttackCommand --> BattleStrategy : uses
UseItemCommand --> InventoryStrategy : uses

' ████████████████████████████████████████████████████████████
'  ITERATOR PATTERN
' ████████████████████████████████████████████████████████████

package "Iterator Pattern" as iterator_pkg ITER_PKG_BG {

    class AreaIterator ITER_BASE_BG {
        - _areas: list
        - _index: int
        + __iter__(): AreaIterator
        + __next__(): dict
        + has_next(): bool
        + current(): dict
        + reset()
        + get_position(): int
    }

    class MenuIterator ITER_CONCRETE_BG {
        - _options: list
        - _index: int
        + __iter__(): MenuIterator
        + __next__(): any
        + has_next(): bool
        + current(): any
        + reset()
        + get_all_options(): list
        + select_option(index): any
    }

    class ExplorationSystem ITER_SYSTEM_BG {
        - area_iterator: AreaIterator
        - current_area: dict
        - visited_areas: list
        + start_exploration(): dict
        + move_to_next_area(): dict
        + get_current_area(): dict
        + get_available_events(): list
        + is_area_safe(): bool
        + get_enemies_in_area(): list
        - _display_area_info()
        + get_exploration_progress(): dict
    }
}

ExplorationSystem o--> AreaIterator : area_iterator

' ████████████████████████████████████████████████████████████
'  OBSERVER PATTERN
' ████████████████████████████████████████████████████████████

package "Observer Pattern" as observer_pkg OBS_PKG_BG {

    class DungeonEvent OBS_BASE_BG {
        - observers: list
        - threshold: int
        + register(observer)
        + unregister(observer)
        + enemy_defeated(enemies_defeated)
    }

    class FinalBoss OBS_CONCRETE_BG {
        - is_awake: bool
        + update(enemies_defeated)
    }
}

DungeonEvent o--> "0..*" FinalBoss : observers
DungeonEvent ..> FinalBoss : notifies

' ████████████████████████████████████████████████████████████
'  STATE PATTERN
' ████████████████████████████████████████████████████████████

package "State Pattern" as state_pkg STATE_PKG_BG {

    class QuestState STATE_BASE_BG {
        + start(quest)
        + complete(quest)
        + fail(quest)
        + get_status()
    }

    class NotStarted STATE_CONCRETE_BG {
        + start(quest)
        + complete(quest)
        + fail(quest)
        + get_status(): str
    }

    class InProgress STATE_CONCRETE_BG {
        + start(quest)
        + complete(quest)
        + fail(quest)
        + get_status(): str
    }

    class Completed STATE_CONCRETE_BG {
        + start(quest)
        + complete(quest)
        + fail(quest)
        + get_status(): str
    }

    class Failed STATE_CONCRETE_BG {
        + start(quest)
        + complete(quest)
        + fail(quest)
        + get_status(): str
    }

    class Quest STATE_CTX_BG {
        - name: str
        - description: str
        - reward: dict
        - state: QuestState
        + start()
        + complete()
        + fail()
        + get_status(): str
        + get_info(): dict
    }
}

QuestState <|-- NotStarted
QuestState <|-- InProgress
QuestState <|-- Completed
QuestState <|-- Failed
Quest o--> QuestState : state

' ████████████████████████████████████████████████████████████
'  DECORATOR PATTERN
' ████████████████████████████████████████████████████████████

package "Decorator Pattern" as decorator_pkg DECO_PKG_BG {

    class CombatDecorator DECO_BASE_BG {
        # _combatant: dict
        + get_stat(stat_name): any
        + apply_effect()
        + remove_effect()
        + get_combatant(): dict
    }

    class StrengthBoostDecorator DECO_CONCRETE_BG {
        - boost_amount: int
        - applied: bool
        + apply_effect()
        + remove_effect()
    }

    class DefenseBoostDecorator DECO_CONCRETE_BG {
        - boost_amount: int
        - applied: bool
        + apply_effect()
        + remove_effect()
    }

    class PoisonDecorator DECO_CONCRETE_BG {
        - damage_per_turn: int
        - duration: int
        - turns_remaining: int
        + apply_effect(): bool
        + remove_effect()
        + is_active(): bool
    }

    class RegenerationDecorator DECO_CONCRETE_BG {
        - heal_per_turn: int
        - duration: int
        - turns_remaining: int
        + apply_effect(): bool
        + remove_effect()
        + is_active(): bool
    }
}

CombatDecorator <|-- StrengthBoostDecorator
CombatDecorator <|-- DefenseBoostDecorator
CombatDecorator <|-- PoisonDecorator
CombatDecorator <|-- RegenerationDecorator

' ████████████████████████████████████████████████████████████
'  FACADE PATTERN
' ████████████████████████████████████████████████████████████

package "Facade Pattern" as facade_pkg FACADE_PKG_BG {

    class CombatFacade FACADE_BG {
        - player: dict
        - enemy: dict
        - command_invoker: CommandInvoker
        - battle_context: BattleContext
        - player_effects: list
        - enemy_effects: list
        - turn_count: int
        - combat_log: list
        - combat_active: bool
        + start_combat(): bool
        + player_attack(strategy_type: str): bool
        + enemy_attack(): bool
        + player_defend(): bool
        + apply_effect_to_player(effect_type, **kwargs): bool
        + apply_effect_to_enemy(effect_type, **kwargs): bool
        + process_turn_effects()
        + get_combat_status(): dict
        + display_combat_status()
        - _get_strategy(strategy_type): BattleStrategy
        - _create_decorator(effect_type, target, **kwargs): CombatDecorator
        - _end_combat(winner)
        + get_combat_log(): list
        + undo_last_action(): bool
    }
}

CombatFacade --> CommandInvoker : command_invoker
CombatFacade --> BattleContext : battle_context
CombatFacade --> AggressiveStrategy : uses
CombatFacade --> DefensiveStrategy : uses
CombatFacade --> BalancedStrategy : uses
CombatFacade --> AttackCommand : creates
CombatFacade --> DefendCommand : creates
CombatFacade --> StrengthBoostDecorator : creates
CombatFacade --> DefenseBoostDecorator : creates
CombatFacade --> PoisonDecorator : creates
CombatFacade --> RegenerationDecorator : creates

' ████████████████████████████████████████████████████████████
'  ADAPTER PATTERN
' ████████████████████████████████████████████████████████████

package "Adapter Pattern" as adapter_pkg ADAPTER_PKG_BG {

    class SaveLoadAdapter ADAPTER_BG {
        - save_directory: str
        + save_game(game_state: dict, save_name: str): str
        + load_game(save_name: str): dict
        + list_saves(): list
        + delete_save(save_name: str): bool
        + create_game_state(player, inventory, quests, current_area, game_progress): dict
        + get_save_info(save_name: str): dict
    }
}

' ████████████████████████████████████████████████████████████
'  GAME MANAGER (Orchestrator)
' ████████████████████████████████████████████████████████████

class GameManager GM_BG {
    - player_factory: PlayerFactory
    - enemy_factory: EnemyFactory
    - area_factory: AreaFactory
    - item_factory: ItemFactory
    - loot_factory: LootFactory
    - save_adapter: SaveLoadAdapter
    - dungeon_event: DungeonEvent
    - final_boss: FinalBoss
    - player: dict
    - inventory: dict
    - quests: list[Quest]
    - areas: list
    - exploration_system: ExplorationSystem
    - current_combat: CombatFacade
    - game_progress: dict
    + initialize_game(player_class: str)
    + start_combat(enemy_name: str): bool
    + execute_combat_turn(action: str, strategy: str): bool
    - _handle_combat_end(): bool
    + explore_next_area(): bool
    + manage_quests(quest_index: int, action: str): bool
    + save_game(save_name: str): str
    + load_game(save_name: str): bool
    + get_game_state_summary(): dict
    + display_game_state()
}

' ─── GameManager Relationships ───
GameManager --> PlayerFactory : player_factory
GameManager --> EnemyFactory : enemy_factory
GameManager --> AreaFactory : area_factory
GameManager --> ItemFactory : item_factory
GameManager --> LootFactory : loot_factory
GameManager --> SaveLoadAdapter : save_adapter
GameManager --> DungeonEvent : dungeon_event
GameManager --> FinalBoss : final_boss
GameManager --> ExplorationSystem : exploration_system
GameManager --> CombatFacade : current_combat
GameManager --> Quest : manages
GameManager --> AreaIterator : creates

' ============================================================
'  LEGEND
' ============================================================
legend right
    | **Color**    | **Design Pattern**   |
    |<FACTORY_CONCRETE_BG>  | Factory              |
    |<STRAT_CONCRETE_BG>    | Strategy             |
    |<CMD_CONCRETE_BG>      | Command              |
    |<ITER_CONCRETE_BG>     | Iterator             |
    |<OBS_CONCRETE_BG>      | Observer             |
    |<STATE_CONCRETE_BG>    | State                |
    |<DECO_CONCRETE_BG>     | Decorator            |
    |<FACADE_BG>            | Facade               |
    |<ADAPTER_BG>           | Adapter              |
    |<GM_BG>                | Game Manager         |
endlegend

@enduml
